<div class="flex flex-col gap-4 mt-10 w-full h-fit">
  <%= render 'clients/dashboards/info' %>
  <div class="mx-4 md:mx-0">
    <%= render 'clients/dashboards/onboarding_steps' %>
  </div>

  <div class="w-full h-fit grid grid-cols-2 md:grid-cols-3 gap-2 mx-auto px-4 md:px-0">
    <%= form_with(model: @business, url: clients_dashboards_business_path(@business), local: true, method: :put,
                  data: { controller: 'dashboard--file-upload' },
                  class: ' h-[140px] md:h-[200px] flex-none order-4 md:order-1 md:col-start-1 row-start-1'
        ) do |form| %>
      <% if @business.logo.present? && @business.logo.attached? %>
        <label
          for="business_logo"
          data-action="mouseenter->dashboard--file-upload#mouseEnterUploaded mouseleave->dashboard--file-upload#mouseLeaveUploaded"
          data-dashboard--file-upload-target="logoUploadContainer"
          class="relative dashboard-glass cursor-pointer w-full h-full  overflow-hidden rounded-2xl border flex flex-col items-center justify-center gap-2 text-[#7731D0]">
          <div
            class="absolute w-full h-full z-10">
            <%= image_tag rails_blob_url(@business.logo), class: 'object-cover w-full h-full' %>
          </div>
          <%- if @business.state == 'new' %>
            <div
              data-action="dashboard--file-upload#mouseClickUploaded"
              data-dashboard--file-upload-target="logoUploadedContainer"
              class="hidden absolute w-full h-full z-20 bg-white/30 flex flex-col items-center justify-center backdrop-blur-sm">
              <div
                data-dashboard--file-upload-target="logoCtaHover"
                class="flex flex-col gap-1 items-center">
                <i
                  data-dashboard--file-upload-target="logoCtaHoverIconPlus"
                  class="lni lni-pencil text-2xl text-white"></i>
                <button
                  data-dashboard--file-upload-target="logoCtaHoverUploadBtn"
                  class="hidden rounded bg-white px-3 py-1 hover:bg-purple-500 hover:text-white">
                  Upload
                </button>
                <p data-dashboard--file-upload-target="logoCtaHoverMessage" class="text-white hidden md:block">Click to
                  update image</p>
                <%= form.file_field :logo, class: 'hidden', data: {
                  action: 'change->dashboard--file-upload#changeFile',
                  'dashboard--file-upload-target': 'logoFile',
                } %>

              </div>
            </div>
          <% else %>
            <div
              data-action="dashboard--file-upload#mouseClickUploaded"
              data-dashboard--file-upload-target="logoUploadedContainer"
              class="hidden absolute w-full h-full z-20 bg-white/30 flex flex-col items-center justify-center backdrop-blur-sm">
              <%= link_to "Edit Image", edit_clients_dashboards_business_path, class: 'px-4 py-2 rounded-md bg-purple-500 text-white' %>
            </div>
          <% end %>
        </label>
      <% else %>
        <label
          data-action="mouseenter->dashboard--file-upload#mouseEnter mouseleave->dashboard--file-upload#mouseLeave click->dashboard--file-upload#mouseClick"
          data-dashboard--file-upload-target="logoUploadContainer"
          for="business_logo" class="guide-test dashboard-glass cursor-pointer w-full h-full border border-[#7731D0] border-dashed rounded-2xl py-14 flex flex-col items-center justify-center gap-2 text-[#7731D0]">
          <div
            data-dashboard--file-upload-target="logoCta"
            class="flex flex-col gap-1 items-center">
            <i class="lni lni-camera text-2xl"></i>
            <p>Business Logo</p>
          </div>
          <div
            data-dashboard--file-upload-target="logoCtaHover"
            class="hidden flex flex-col gap-1 items-center">
            <i
              data-dashboard--file-upload-target="logoCtaHoverIconPlus"
              class="lni lni-plus text-2xl"></i>
            <button
              data-dashboard--file-upload-target="logoCtaHoverUploadBtn"
              class="hidden border rounded px-3 py-1 hover:bg-purple-500 hover:text-white">
              Upload
            </button>
            <p data-dashboard--file-upload-target="logoCtaHoverMessage" class="hidden md:block">Click to add image</p>
            <%= form.file_field :logo, class: 'hidden', data: {
              action: 'change->dashboard--file-upload#changeFile',
              'dashboard--file-upload-target': 'logoFile',
            } %>

          </div>

        </label>
      <% end %>
    <% end %>

    <%= form_with(model: @business, url: clients_dashboards_business_path(@business), local: true, method: :put,
                  data: { controller: 'dashboard--file-upload' },
                  class: 'flex-none order-5 md:order-3 h-[140px] md:h-[200px] row-start-1 md:row-start-2'
        ) do |form| %>
      <% if @business.listing.present? && @business.listing.attached? %>
        <label
          for="business_listing"
          data-action="mouseenter->dashboard--file-upload#mouseEnterUploaded mouseleave->dashboard--file-upload#mouseLeaveUploaded"
          data-dashboard--file-upload-target="logoUploadContainer"
          class="relative dashboard-glass cursor-pointer w-full h-full overflow-hidden rounded-2xl border flex flex-col items-center justify-center gap-2 text-[#7731D0]">
          <div
            class="absolute w-full h-full z-10">
            <%= image_tag url_for(@business.listing), class: 'object-cover w-full h-full' %>
          </div>
          <%- if @business.state == 'new' %>
            <div
              data-action="dashboard--file-upload#mouseClickUploaded"
              data-dashboard--file-upload-target="logoUploadedContainer"
              class="hidden absolute w-full h-full z-20 bg-white/30 flex flex-col items-center justify-center backdrop-blur-sm">
              <div
                data-dashboard--file-upload-target="logoCtaHover"
                class="flex flex-col gap-1 items-center">
                <i
                  data-dashboard--file-upload-target="logoCtaHoverIconPlus"
                  class="lni lni-pencil text-2xl text-white"></i>
                <button
                  data-dashboard--file-upload-target="logoCtaHoverUploadBtn"
                  class="hidden rounded bg-white px-3 py-1 hover:bg-purple-500 hover:text-white">
                  Upload
                </button>
                <p data-dashboard--file-upload-target="logoCtaHoverMessage" class="text-white hidden md:block">Click to
                  update image</p>
                <%= form.file_field :listing, class: 'hidden', data: {
                  action: 'change->dashboard--file-upload#changeFile',
                  'dashboard--file-upload-target': 'logoFile',
                } %>

              </div>
            </div>
          <% else %>
            <div
              data-action="dashboard--file-upload#mouseClickUploaded"
              data-dashboard--file-upload-target="logoUploadedContainer"
              class="hidden absolute w-full h-full z-20 bg-white/30 flex flex-col items-center justify-center backdrop-blur-sm">
              <%= link_to "Edit Image", edit_clients_dashboards_business_path, class: 'px-4 py-2 rounded-md bg-purple-500 text-white' %>
            </div>
          <% end %>
        </label>
      <% else %>
        <label
          data-action="mouseenter->dashboard--file-upload#mouseEnter mouseleave->dashboard--file-upload#mouseLeave click->dashboard--file-upload#mouseClick"
          data-dashboard--file-upload-target="logoUploadContainer"
          for="business_listing" class="dashboard-glass cursor-pointer w-full h-full border border-[#BF2D6A] border-dashed rounded-2xl py-14 flex flex-col items-center justify-center gap-2 text-[#BF2D6A]">
          <div
            data-dashboard--file-upload-target="logoCta"
            class="flex flex-col gap-1 items-center">
            <i class="lni lni-pointer-top text-2xl"></i>
            <p>Listing Image</p>
          </div>
          <div
            data-dashboard--file-upload-target="logoCtaHover"
            class="hidden flex flex-col gap-1 items-center">
            <i
              data-dashboard--file-upload-target="logoCtaHoverIconPlus"
              class="lni lni-plus text-2xl"></i>
            <button
              data-dashboard--file-upload-target="logoCtaHoverUploadBtn"
              class="hidden border rounded px-3 py-1 hover:bg-purple-500 hover:text-white">
              Upload
            </button>
            <p data-dashboard--file-upload-target="logoCtaHoverMessage" class="hidden md:block">Click to add image</p>
            <%= form.file_field :listing, class: 'hidden', data: {
              action: 'change->dashboard--file-upload#changeFile',
              'dashboard--file-upload-target': 'logoFile',
            } %>

          </div>
        </label>
      <% end %>
    <% end %>

    <div
      data-controller="dashboard--detail"
      class="order-1 md:order-2 w-full col-span-2 rounded-2xl h-[200px] p-6 flex flex-col justify-start gap-2 bg-gradient-to-l from-violet-500 to-indigo-500 rounded-[20px] shadow text-white">
      <div class="flex justify-between items-center">
        <div class="flex flex-col md:flex-row md:gap-4 md:items-center">
          <h1 class="text-2xl text-white"><%= @business.name %></h1>
          <small class="text-xs text-gray-300"><%= @business.registration_id %></small>
        </div>
        <%= link_to edit_clients_dashboards_business_path, class: 'flex items-center' do %>
          <i class="lni lni-pencil-alt"></i>
        <% end %>
      </div>
      <p class="text-sm">
        <% if @business.address_line_1.present? %><%= @business.address_line_1 %><br>
        <% end %>
        <% if @business.address_line_2.present? %><%= @business.address_line_2 %><br>
        <% end %>
        <%= @business.postcode.present? ? @business.postcode + ',' : '' %> <%= @business.city %><br>
        <%= @business.state %>
      </p>
    </div>

    <%= link_to clients_dashboards_path,
                class: 'cursor-pointer order-2 py-4 md:py-0 md:order-4 w-full h-[140px] md:h-[200px] bg-gradient-to-l from-violet-500 to-indigo-500 rounded-2xl shadow flex flex-col items-center justify-center text-white gap-4',
                style: 'box-shadow: 0px 4px 10px rgba(131, 105, 221, 0.50);' do %>
      <h2 class="text-4xl md:text-6xl"><%= @regulars_total || 0 %></h2>
      <p class="text-sm">Regulars</p>
    <% end %>

    <%= link_to clients_dashboards_customers_path, class: 'cursor-pointer order-3 py-4 md:py-0 md:order-5 w-full h-[140px] bg-purple-200 md:h-[200px] rounded-2xl flex flex-col items-center justify-center gap-4 text-gray-700' do %>
      <h2 class="text-4xl md:text-6xl"><%= @reviews %></h2>
      <p class="text-sm">Customers</p>
    <% end %>
  </div>

  <div class="w-full h-fit px-4 mt-10 mb-20 md:hidden">
    <h2 class="pl-2 text-lg text-gray-400">Manage Business</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mx-auto md:px-0 mt-2">
      <%= link_to clients_dashboards_reward_path, class: 'cursor-pointer order-3 py-10 md:order-5 w-full h-fit bg-gray-200 h-fit rounded-2xl flex flex-col items-center justify-center gap-4 text-gray-700' do %>
        <p>Manage Rewards</p>
      <% end %>
    </div>
  </div>
</div>
